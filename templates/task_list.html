<div class="card mt-3">
    <div class="card-body">
        <h4 id="task-title" class="card-title">{{ person_name if person_name else "タスク一覧" }}</h4>
        <ul id="task-list" class="list-group mt-3">
            {% for task in tasks %}
            <li class="list-group-item" data-task-id="{{ task.id }}" data-deadline="{{ task.deadline }}">
                {{ task.content | safe }}
                {% if task.person %}
                <br><strong>担当者:</strong> {{ task.person.name }}
                {% else %}
                <br><strong>担当者:</strong> 未割り当て
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<style>
    .deadline-near {
        background-color: #ffcccc;
    }
    .deadline-today-or-past {
        background-color: #ff9999;
    }
</style>

<script>
    document.querySelectorAll('.list-group-item').forEach(function(taskItem) {
        let deadline = new Date(taskItem.dataset.deadline);
        let today = new Date();

        if (!isNaN(deadline)) {
            let timeDiff = deadline - today;
            if (timeDiff < 0) {
                taskItem.classList.add('deadline-today-or-past');
            } else if (timeDiff <= (1000 * 60 * 60 * 24 * 3)) {
                taskItem.classList.add('deadline-near');
            }
        }
    });
</script>
